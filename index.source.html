<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>振興五倍加碼券速查</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <meta property="og:image" content="https://onlinemad.github.io/5000-lottery/cover.webp" />
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script src="./js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        body {
            width: 50%;
            margin: auto;
        }

        .main {
            text-align: center;
        }

        .main textarea {
            font-size: 20pt;
        }
    </style>

</head>

<body class="text-center main" onload="loadUid()">
    <div class="alert alert-success" role="alert">
        <h1 class="alert-heading">振興五倍加碼券速查</h1>
        <hr>
        <p class="mb-0">新增【第二週】國旅券</p>
    </div>
    <div class="alert alert-warning d-flex align-items-center" role="alert">
        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Warning:">
            <use xlink:href="#exclamation-triangle-fill" />
        </svg>
        <div>
            非官方，加碼券說明請看<a href="https://5000.gov.tw/" class="text-decoration-none" target="_blank">振興五倍券官網</a>
        </div>
    </div>
    <div class="form-floating ">
        <textarea class="form-control" placeholder="請輸入身分證字號（至少輸入末三碼），用 , 分開多筆" id="uid"></textarea>
        <label for="uid">請輸入身分證字號（至少輸入末三碼），用 , 分開多筆</label>
    </div>
    <button class="w-100 btn btn-lg btn-primary" type="button" onclick="query()">查詢</button>
    <div class="card">
        <div class="card-body">
            <h2 class="card-title">查詢結果</h2>
            <p class="card-text">
            <dl id="result"></dl>
            </p>
            <div id="mask" style="display:none"><button class="btn btn-secondary" onclick="mask()">
                    碼掉身分證字號 for 截圖分享
                </button>
            </div>
        </div>
    </div>
    </div>
    <div class="container">
        <footer>
            <p>
                無廣告、無追蹤碼<br />
                身分證字號暫存在瀏覽器內，你也可以<a href="#" onclick="clean()">清除暫存</a> <br />
                網站以<a href="https://github.com/onlinemad/5000-lottery" target="_blank">開放原始碼方式釋出</a>
            </p>
        </footer>
    </div>
</body>

<script>
    let coupons = [{
        name: '【第一週】國旅券',
        codes: ['21', '32', '98', '67', '97', '410']
    }, {
        name: '【第一週】i原券',
        codes: ['64', '85']
    }, {
        name: '【第一週】農遊券',
        codes: ['89', '32', '54', '597', '453', '152']
    }, {
        name: '【第一週】藝fun券(數位)',
        codes: ['96', '15', '07', '30', '73', '98', '19', '11']
    }, {
        name: '【第一週】藝fun券(紙本)',
        codes: ['39', '37', '23', '36', '79', '08', '14', '75']
    }, {
        name: '【第一週】動滋券',
        codes: ['97', '13', '19', '55', '71', '93', '381', '734', '644', '453', '985']
    }, {
        name: '【第一週】客庄劵2.0',
        codes: ['81', '900']
    }, {
        name: '【第一週】地方創生券',
        codes: ['081', '105', '594', '188', '089', '396', '521', '467', '912', '798', '358', '441', '367', '941', '335']
    }, {
        name: '【第二週】國旅券',
        codes: ['87', '04', '40', '29', '71']
    }]

    let rs = []

    let search = (ids, coupons) => {
        let _rs = ids.map((id) => {
            let winning = []
            coupons.map((coupon) => {
                coupon.codes.map((code) => {
                    if (id.slice(-code.length) === code) {
                        winning.push(`${coupon.name} [${code}]`)
                    }
                })
            })
            return {
                id: id,
                winning: winning
            }
        })
        return _rs
    }

    let uid = null

    function loadUid() {
        uid = document.getElementById('uid')
        uid.value = localStorage.getItem('uid')
    }

    function render(_rs) {
        let result = document.getElementById('result')
        result.innerHTML = ''
        _rs.map((r) => {
            let td = document.createElement('td')
            td.appendChild(document.createTextNode(r.id))
            result.appendChild(td)

            let dd = document.createElement('dd')
            if (r.winning.length > 0) {
                let ul = document.createElement('td')
                r.winning.map((w) => {
                    let li = document.createElement('dd')
                    li.appendChild(document.createTextNode(w))
                    result.appendChild(li)
                })
            } else {
                dd.appendChild(document.createTextNode('都沒中'))
                result.appendChild(dd)
            }
        })
    }

    function query() {
        uid.style.display = null

        let uids = uid.value.split(',').map((_uid) => _uid.trim())
        localStorage.setItem('uid', uids.toString())

        rs = search(uids, coupons)
        render(rs)
        document.getElementById('mask').style.display = 'block'
    }

    function mask() {
        uid.style.display = 'none'
        render(rs.map((r) => {
            r.id = r.id.replace(/[a-z\d]/gi, '*')
            return r
        }))
    }

    function clean() {
        uid.value = ''
        uid.style.display = null
        localStorage.removeItem('uid')
        rs = []
        render(rs)
        document.getElementById('mask').style.display = 'none'
    }
</script>

</html>